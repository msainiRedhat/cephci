#
# Objective: Test rgw with ssl configured using ceph-ansible and upgrade
# Polarion ID: CEPH-83574678
#
---
tests:
  - test:
      name: install ceph pre-requisities
      module: install_prereq.py
      abort-on-fail: true

  - test:
      name: ceph ansible
      module: test_ansible.py
      config:
        use_cdn: true
        build: "4.x"
        ansi_config:
          ceph_origin: repository
          ceph_repository_type: cdn
          ceph_rhcs_version: 4
          ceph_repository: rhcs
          osd_scenario: lvm
          osd_auto_discovery: false
          fetch_directory: ~/fetch
          copy_admin_key: true
          dashboard_enabled: false
          ceph_docker_image: "rhceph/rhceph-4-rhel8"
          ceph_docker_image_tag: "latest"
          ceph_docker_registry: "registry.redhat.io"
          radosgw_frontend_ssl_certificate: "/etc/ceph/server.pem"
          radosgw_frontend_port: 443
      desc: test cluster setup using ceph-ansible
      destroy-cluster: false
      polarion-id: CEPH-83574766
      abort-on-fail: true

  - test:
      name: check-ceph-health
      module: exec.py
      config:
        commands:
          - "ceph -s"
          - "ceph versions"
        sudo: true
      desc: check for ceph status and version


  # versioning tests
  - test:
      name: Test deletion of object versions
      desc: test to delete versioning objects
      polarion-id: CEPH-14262
      module: sanity_rgw.py
      config:
        script-name: test_versioning_with_objects.py
        config-file-name: test_versioning_objects_delete.yaml
        timeout: 300


  # switch from rpm to container
  - test:
      name: switch-from-non-containerized-to-containerized-ceph-daemons
      polarion-id: CEPH-83573510
      module: switch_rpm_to_container.py
      abort-on-fail: true
